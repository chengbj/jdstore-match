

<script src="//maps.google.com/maps/api/js?key=AIzaSyDy_7w8M1OkdUbg1tQZajVFG_7upzZVolA"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> 


<!-- only if you need custom infoboxes -->
<% p= Product.first  %>
<div style ="display:none;" >
	<div id="p-location" value=<%= p.location %>>
		<span><%= p.location %></span>
	</div>
</div>


<div style='width: 800px;' id="sidebar_container">
<button class="btn btn-default" id="controller">controller</button>
</div>
<script type="text/javascript">
	
 $('#controller').on('click', function(){
console.log("show");
$('#sidebar_builder').show();
    	console.log("map");
  	handler = Gmaps.build('Google');
	handler.buildMap({ internal: {id: 'sidebar_builder'}}, function(){
	if ($('#p-location').attr('value')=="Shenzhen"){
	marker = handler.addMarkers(<%=raw @hash.to_json %>);
	    handler.bounds.extendWith(marker);
    handler.fitMapToBounds();
    }});  } ) 

</script>
  <div id="sidebar_builder" style='width: 800px; height: 400px;display: none ;'>
  	<script type="text/javascript">
  	function myFunction(){
  	console.log("map");
  	handler = Gmaps.build('Google');
	handler.buildMap({ internal: {id: 'sidebar_builder'}}, function(){
	if ($('#p-location').attr('value')=="Shenzhen"){
	marker = handler.addMarkers(<%=raw @hash.to_json %>);
	    handler.bounds.extendWith(marker);
    handler.fitMapToBounds();
    }});}
</script>

  </div>



